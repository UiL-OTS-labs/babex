# Generated by Django 4.0.7 on 2022-12-06 10:17

from django.db import migrations, models


def migrate_leaders(apps, schema_editor):
    Experiment = apps.get_model('experiments', 'Experiment')
    for exp in Experiment.objects.all():
        exp.leaders.add(exp.leader)
        for leader in exp.additional_leaders.all():
            exp.leaders.add(leader)


def revert_leaders(apps, schema_editor):
    Experiment = apps.get_model('experiments', 'Experiment')
    for exp in Experiment.objects.all():
        leaders = list(exp.leaders.all())
        exp.leader = leaders[0]
        for leader in leaders[1:]:
            exp.additional_leaders.add(leader)


class Migration(migrations.Migration):

    dependencies = [
        ('leaders', '0001_initial'),
        ('experiments', '0034_remove_experiment_participants_visible'),
    ]

    operations = [
        migrations.AddField(
            model_name='experiment',
            name='leaders',
            field=models.ManyToManyField(blank=True, help_text='experiment:attribute:leaders:help_text', related_name='experiments', to='leaders.leader', verbose_name='experiment:attribute:leaders'),
        ),
        migrations.RunPython(migrate_leaders, revert_leaders),
        migrations.RemoveField(
            model_name='experiment',
            name='additional_leaders',
        ),
        migrations.RemoveField(
            model_name='experiment',
            name='leader',
        ),
    ]
