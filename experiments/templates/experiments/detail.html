{% extends "base/base.html" %}
{% load i18n %}
{% load transformat %}
{% load datatables %}
{% load get_field_name %}
{% load static %}

{% block header_title %}
   {% transformat 'experiments:detail:header' experiment.name %} - {{ block.super }}
{% endblock %}

{% block content %}
<div class="uu-inner-container">
    <div class="col-12">
        <div class="button button-colored float-right" id="back_to_prev">
            <a href="{% url 'experiments:home' %}">
                {% trans 'experiments:detail:all_experiments' %}
            </a>
        </div>
        <h1>
            {% transformat 'experiments:detail:header' experiment.name %}
        </h1>
    </div>
</div>
<div class="uu-inner-container">
    <div class="col-6">
        <h3 class="d-inline">
            {% trans 'experiments:detail:info' %}
        </h3>
        <a href="{% url 'experiments:update' experiment.pk %}?next={{ request.path }}">
            {% trans 'experiments:detail:edit_info' %}
        </a>
        <br/>
        <div class="d-inline-block">
            <table class="criteria-table mt-1">
                <tr>
                    <td>
                        {% trans 'experiments:detail:info:duration' %}
                    </td>
                    <td>
                        {{ experiment.duration }}
                    </td>
                </tr>
                <tr>
                    <td>
                        {% trans 'experiments:detail:info:compensation' %}
                    </td>
                    <td>
                        {{ experiment.compensation }}
                    </td>
                </tr>
                <tr>
                    <td>
                        {% trans 'experiments:detail:info:task_description' %}
                    </td>
                    <td>
                        {{ experiment.task_description }}
                    </td>
                </tr>
                <tr>
                    <td>
                        {% trans 'experiments:detail:info:additional_instructions' %}
                    </td>
                    <td>
                        {{ experiment.additional_instructions }}
                    </td>
                </tr>
                <tr>
                    <td>
                        {% trans 'experiments:detail:info:location' %}
                    </td>
                    <td>
                        {{ experiment.location }}
                    </td>
                </tr>
                <tr>
                    <td>
                        {% trans 'experiments:detail:info:open' %}
                    </td>
                    <td>
                        {{ experiment.open|yesno:_("yes,no") }}
                    </td>
                </tr>
                <tr>
                    <td>
                        {% trans 'experiments:detail:info:public' %}
                    </td>
                    <td>
                        {{ experiment.public|yesno:_("yes,no") }}
                    </td>
                </tr>
                <tr>
                    <td>
                        {% trans 'experiments:detail:info:participants_visible' %}
                    </td>
                    <td>
                        {{ experiment.participants_visible|yesno:_("yes,no") }}
                    </td>
                </tr>
                <tr>
                    <td>
                        {% trans 'experiments:detail:info:leader' %}
                    </td>
                    <td>
                        {{ experiment.leader }}
                    </td>
                </tr>
            </table>
        </div>
    </div>
    <div class="col-6">
        <h3 class="d-inline">
            {% trans 'experiments:detail:criteria' %}
        </h3>
        <a href="{% url 'experiments:default_criteria' experiment.pk %}?next={{ request.path }}">
            {% trans 'experiments:detail:edit_default_criteria' %}
        </a>
        -
        <a href="{% url 'experiments:specific_criteria' experiment.pk %}">
            {% trans 'experiments:detail:edit_specific_criteria' %}
        </a><br/>
        {% include 'experiments/criteria_snippit.html' %}
    </div>
</div>
    <br/>
<div class="uu-inner-container">
    <div class="col-12">
        <h3 class="d-inline">
            {% trans 'experiments:detail:appointments' %}
        </h3>
        <a href="{% url 'experiments:timeslots' experiment.pk %}">
            {% trans 'experiments:detail:appointments:edit_timeslots' %}
        </a>
        -
        <a href="{% url 'experiments:participants' experiment.pk %}">
            {% trans 'experiments:detail:appointments:view_participants' %}
        </a>
        <br/>
        <br/>
        <table class="w-100 dt">
            <thead>
                <tr>
                    <th class="w-50">
                        {% trans 'experiments:detail:appointments:datetime' %}
                    </th>
                    <th class="w-25">
                        {% trans 'experiments:detail:appointments:free_places' %}
                    </th>
                    <th class="w-25">
                        {% trans 'experiments:detail:appointments:taken_places' %}
                    </th>
                </tr>
            </thead>
            {% for datetime, free_places, taken_places in appointments %}
                <tr>
                    <td data-order="{{ datetime|date:'U' }}">
                        {{ datetime }}
                    </td>
                    <td>
                        {{ free_places }}
                    </td>
                    <td>
                        {{ taken_places }}
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>
</div>
<div class="uu-inner-container">
    <div class="col-12">
        <h3>
            {% trans 'experiments:detail:comments' %}
        </h3>
        <br/>
        <table class="w-100 dt">
            <thead>
                <tr>
                    <th>
                        {% trans 'experiments:detail:comments:participant' %}
                    </th>
                    <th>
                        {% trans 'experiments:detail:comments:email' %}
                    </th>
                    <th>
                        {% trans 'experiments:detail:comments:added_by' %}
                    </th>
                    <th>
                        {% trans 'experiments:detail:comments:added_on' %}
                    </th>
                    <th class="w-25">
                        {% trans 'experiments:detail:comments:comment' %}
                    </th>
                    <th>
                        {% trans 'experiments:globals:actions' %}
                    </th>
                </tr>
            </thead>
            {% for comment in comments %}
                <tr>
                    <td>
                        {{ comment.participant.name }}
                    </td>
                    <td>
                        {{ comment.participant.email }}
                    </td>
                    <td>
                        {% if comment.system_comment %}
                                {% trans 'experiments:detail:comment:system_user' %}
                            {% elif comment.leader %}
                                {{ comment.leader.name }}
                            {% else %}
                                {% trans 'experiments:detail:comment:admin_user' %}
                            {% endif %}
                    </td>
                    <td data-order="{{ comment.datetime|date:'U' }}">
                        {{ comment.datetime|date:"Y-m-d H:i" }}
                    </td>
                    <td>
                        {{ comment.comment }}
                    </td>
                    <td class="text-center">
                        <a  href="{% url 'comments:delete' comment.pk %}?next={{ request.path }}"
                            title="{% trans 'experiments:detail:comment:delete' %}"
                            class="icon-delete">
                            î¦¬
                        </a>
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>
</div>
<br/>
{% endblock %}